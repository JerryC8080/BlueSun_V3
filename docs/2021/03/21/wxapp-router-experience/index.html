<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>å¾®ä¿¡å°ç¨‹åºè·¯ç”±å®æˆ˜ | BlueSun</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="å¾®ä¿¡å°ç¨‹åº," />
  

  <meta name="description" content="0. ç›®å½•
1. å‰è¨€
2. æ™ºèƒ½è·¯ç”±è·³è½¬ â€” Navigator æ¨¡å—
3. è™šæ‹Ÿè·¯ç”±ç­–ç•¥ â€” Router æ¨¡å—
4. è½åœ°ä¸­è½¬ç­–ç•¥ â€” LandTransfer æ¨¡å—
4.1. å¯¹äºè¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šç»Ÿä¸€çš„è½åœ°é¡µ
4.2. å¯¹äºç¬¬äºŒä¸ªè¦è§£å†³çš„é—®é¢˜ï¼šçŸ­é“¾å‚æ•°
4.3. LandTransfer æ¨¡å—è®¾è®¡


5. æ›´å¥½çš„å¼€å‘ä½“éªŒ
5.1. Typescript + Router
5.2. æ™º">
<meta property="og:type" content="article">
<meta property="og:title" content="å¾®ä¿¡å°ç¨‹åºè·¯ç”±å®æˆ˜">
<meta property="og:url" content="http://huang-jerryc.com/2021/03/21/wxapp-router-experience/index.html">
<meta property="og:site_name" content="BlueSun">
<meta property="og:description" content="0. ç›®å½•
1. å‰è¨€
2. æ™ºèƒ½è·¯ç”±è·³è½¬ â€” Navigator æ¨¡å—
3. è™šæ‹Ÿè·¯ç”±ç­–ç•¥ â€” Router æ¨¡å—
4. è½åœ°ä¸­è½¬ç­–ç•¥ â€” LandTransfer æ¨¡å—
4.1. å¯¹äºè¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šç»Ÿä¸€çš„è½åœ°é¡µ
4.2. å¯¹äºç¬¬äºŒä¸ªè¦è§£å†³çš„é—®é¢˜ï¼šçŸ­é“¾å‚æ•°
4.3. LandTransfer æ¨¡å—è®¾è®¡


5. æ›´å¥½çš„å¼€å‘ä½“éªŒ
5.1. Typescript + Router
5.2. æ™º">
<meta property="og:image" content="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210321202552.png">
<meta property="og:image" content="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210321202632.png">
<meta property="og:image" content="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210321202636.png">
<meta property="og:image" content="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210309185153.png">
<meta property="og:image" content="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210312182826.png">
<meta property="og:image" content="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210309185154.png">
<meta property="og:image" content="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210321202654.png">
<meta property="og:image" content="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210321202700.png">
<meta property="og:updated_time" content="2021-03-21T12:40:39.210Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="å¾®ä¿¡å°ç¨‹åºè·¯ç”±å®æˆ˜">
<meta name="twitter:description" content="0. ç›®å½•
1. å‰è¨€
2. æ™ºèƒ½è·¯ç”±è·³è½¬ â€” Navigator æ¨¡å—
3. è™šæ‹Ÿè·¯ç”±ç­–ç•¥ â€” Router æ¨¡å—
4. è½åœ°ä¸­è½¬ç­–ç•¥ â€” LandTransfer æ¨¡å—
4.1. å¯¹äºè¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šç»Ÿä¸€çš„è½åœ°é¡µ
4.2. å¯¹äºç¬¬äºŒä¸ªè¦è§£å†³çš„é—®é¢˜ï¼šçŸ­é“¾å‚æ•°
4.3. LandTransfer æ¨¡å—è®¾è®¡


5. æ›´å¥½çš„å¼€å‘ä½“éªŒ
5.1. Typescript + Router
5.2. æ™º">
<meta name="twitter:image" content="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210321202552.png">

  

  
    <link rel="icon" href="/images/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-83430919-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?b65b3ffc3fd0d14c968e1036793e631b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">ç›’å­</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">ç›’å­</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            åšå®¢
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            åˆ†ç±»
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            å‹é“¾
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            å…³äº
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/atom.xml"
            rel="noopener noreferrer"
            target="_blank"
            >
            RSS
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0-ç›®å½•"><span class="toc-text">0. ç›®å½•</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-å‰è¨€"><span class="toc-text">1. å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-æ™ºèƒ½è·¯ç”±è·³è½¬-â€”-Navigator-æ¨¡å—"><span class="toc-text">2. æ™ºèƒ½è·¯ç”±è·³è½¬ â€” Navigator æ¨¡å—</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-è™šæ‹Ÿè·¯ç”±ç­–ç•¥-â€”-Router-æ¨¡å—"><span class="toc-text">3. è™šæ‹Ÿè·¯ç”±ç­–ç•¥ â€” Router æ¨¡å—</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-è½åœ°ä¸­è½¬ç­–ç•¥-â€”-LandTransfer-æ¨¡å—"><span class="toc-text">4. è½åœ°ä¸­è½¬ç­–ç•¥ â€” LandTransfer æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-å¯¹äºè¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šç»Ÿä¸€çš„è½åœ°é¡µ"><span class="toc-text">4.1. å¯¹äºè¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šç»Ÿä¸€çš„è½åœ°é¡µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-å¯¹äºç¬¬äºŒä¸ªè¦è§£å†³çš„é—®é¢˜ï¼šçŸ­é“¾å‚æ•°"><span class="toc-text">4.2. å¯¹äºç¬¬äºŒä¸ªè¦è§£å†³çš„é—®é¢˜ï¼šçŸ­é“¾å‚æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-LandTransfer-æ¨¡å—è®¾è®¡"><span class="toc-text">4.3. LandTransfer æ¨¡å—è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-æ›´å¥½çš„å¼€å‘ä½“éªŒ"><span class="toc-text">5. æ›´å¥½çš„å¼€å‘ä½“éªŒ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-Typescript-Router"><span class="toc-text">5.1. Typescript + Router</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-æ™ºèƒ½ç”Ÿæˆè·¯ç”±é…ç½®"><span class="toc-text">5.2. æ™ºèƒ½ç”Ÿæˆè·¯ç”±é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-è‡ªå®šä¹‰ç»„ä»¶è·³è½¬"><span class="toc-text">5.3. è‡ªå®šä¹‰ç»„ä»¶è·³è½¬</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-æ•´ä½“æ¶æ„å›¾"><span class="toc-text">6. æ•´ä½“æ¶æ„å›¾</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-æœ€åçš„æœ€å"><span class="toc-text">7. æœ€åçš„æœ€å</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-wxapp-router-experience" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">å¾®ä¿¡å°ç¨‹åºè·¯ç”±å®æˆ˜</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2021.03.21</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>JerryC</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/æ¬ç –ç å†œ/">æ¬ç –ç å†œ</a>
  </span>



      
        <span>
          <i class="icon-comment"></i>
          <a href="http://huang-jerryc.com//2021/03/21/wxapp-router-experience/#disqus_thread"></a>
        </span>
      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbspçƒ­åº¦ <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>â„ƒ
        </span>
      
      
    </div>
  </header>

  <div class="article-content">
    
      <h1 id="0-ç›®å½•"><a href="#0-ç›®å½•" class="headerlink" title="0. ç›®å½•"></a>0. ç›®å½•</h1><ul>
<li><a href="#1-å‰è¨€">1. å‰è¨€</a></li>
<li><a href="#2-æ™ºèƒ½è·¯ç”±è·³è½¬--navigator-æ¨¡å—">2. æ™ºèƒ½è·¯ç”±è·³è½¬ â€” Navigator æ¨¡å—</a></li>
<li><a href="#3-è™šæ‹Ÿè·¯ç”±ç­–ç•¥--router-æ¨¡å—">3. è™šæ‹Ÿè·¯ç”±ç­–ç•¥ â€” Router æ¨¡å—</a></li>
<li><a href="#4-è½åœ°ä¸­è½¬ç­–ç•¥--landtransfer-æ¨¡å—">4. è½åœ°ä¸­è½¬ç­–ç•¥ â€” LandTransfer æ¨¡å—</a><ul>
<li><a href="#41-å¯¹äºè¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜ç»Ÿä¸€çš„è½åœ°é¡µ">4.1. å¯¹äºè¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šç»Ÿä¸€çš„è½åœ°é¡µ</a></li>
<li><a href="#42-å¯¹äºç¬¬äºŒä¸ªè¦è§£å†³çš„é—®é¢˜çŸ­é“¾å‚æ•°">4.2. å¯¹äºç¬¬äºŒä¸ªè¦è§£å†³çš„é—®é¢˜ï¼šçŸ­é“¾å‚æ•°</a></li>
<li><a href="#43-landtransfer-æ¨¡å—è®¾è®¡">4.3. LandTransfer æ¨¡å—è®¾è®¡</a></li>
</ul>
</li>
<li><a href="#5-æ›´å¥½çš„å¼€å‘ä½“éªŒ">5. æ›´å¥½çš„å¼€å‘ä½“éªŒ</a><ul>
<li><a href="#51-typescript--router">5.1. Typescript + Router</a></li>
<li><a href="#52-æ™ºèƒ½ç”Ÿæˆè·¯ç”±é…ç½®">5.2. æ™ºèƒ½ç”Ÿæˆè·¯ç”±é…ç½®</a></li>
<li><a href="#53-è‡ªå®šä¹‰ç»„ä»¶è·³è½¬">5.3. è‡ªå®šä¹‰ç»„ä»¶è·³è½¬</a></li>
</ul>
</li>
<li><a href="#6-æ•´ä½“æ¶æ„å›¾">6. æ•´ä½“æ¶æ„å›¾</a></li>
<li><a href="#7-æœ€åçš„æœ€å">7. æœ€åçš„æœ€å</a></li>
</ul>
<h1 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h1><p>åœ¨å¾®ä¿¡å°ç¨‹åºç”±ä¸€ä¸ª <code>App()</code>å®ä¾‹ï¼Œå’Œä¼—å¤š<code>Page()</code>ç»„æˆã€‚è€Œåœ¨å°ç¨‹åºä¸­æ‰€æœ‰é¡µé¢çš„è·¯ç”±å…¨éƒ¨ç”±æ¡†æ¶è¿›è¡Œç®¡ç†ï¼Œæ¡†æ¶ä»¥æ ˆçš„å½¢å¼ç»´æŠ¤äº†æ‰€æœ‰é¡µé¢ï¼Œç„¶åæä¾›äº†ä»¥ä¸‹ API æ¥è¿›è¡Œè·¯ç”±ä¹‹é—´çš„è·³è½¬ï¼š</p>
<ol>
<li><code>wx.navigateTo</code></li>
<li><code>wx.redirectTo</code></li>
<li><code>wx.navigateBack</code></li>
<li><code>wx.switchTab</code></li>
<li><code>wx.reLaunch</code> </li>
</ol>
<p>ä½†æ˜¯ï¼Œå¯¹äºä¸€ä¸ªä¼ä¸šåº”ç”¨ï¼ŒæŠŠè¿™äº›é—®é¢˜ç•™ç»™äº†å¼€å‘è€…ï¼š</p>
<ol>
<li>åŸç”Ÿ API ä½¿ç”¨äº† <code>Callback</code> çš„å‡½æ•°å®ç°å½¢å¼ï¼Œä¸æˆ‘ä»¬ç°ä»£æ™®éçš„ <code>Promise</code> å’Œ <code>async/await</code> å­˜åœ¨ gapã€‚</li>
<li>åŸºäºå°ç¨‹åºè·¯ç”±çš„è®¾è®¡ï¼Œæš´éœ²ç»™å¤–éƒ¨çš„æ˜¯çœŸå®è·¯ç”±ï¼ˆå¦‚æ‰«ç ï¼Œå…¬ä¼—å·é“¾æ¥ç­‰æ–¹å¼ï¼‰ï¼Œå¯¹åç»­é¡¹ç›®é‡æ„ç•™ä¸‹å†å²åŒ…è¢±ã€‚</li>
<li>å°ç¨‹åºé¡µé¢æ ˆæœ€å¤šåå±‚ï¼Œ åœ¨è¶…è¿‡åå±‚å <code>wx.navigateTo</code> å¤±æ•ˆï¼Œéœ€è¦å¼€å‘è€…åˆ¤æ–­ä½¿ç”¨ <code>wx.redirectTo</code> æˆ–å…¶ä»–API</li>
<li>å°ç¨‹åºé¡µé¢æ ˆå­˜åœ¨ä¸€ç§ç‰¹æ®Šçš„é¡µé¢ï¼šTab é¡µé¢ï¼Œéœ€è¦ä½¿ç”¨ <code>wx.switchTab</code> æ‰èƒ½è·³è½¬ã€‚éœ€è¦å¼€å‘è€…ä¸»åŠ¨åˆ¤æ–­ï¼Œä¸æ–¹ä¾¿åæœŸæ”¹åŠ¨ Tab é¡µé¢å±æ€§ã€‚</li>
<li>é¢å¤–çš„ï¼Œå¯¹äºå°ç¨‹åºç ï¼Œè¦ä½¿ç”¨æ— æ•°é‡é™åˆ¶ API <a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/qr-code/wxacode.getUnlimited.html" target="_blank" rel="external">wxacode.getUnlimited</a> ï¼Œå­˜åœ¨å‚æ•°é•¿åº¦é™åˆ¶32ä½ä»¥å†…ã€‚éœ€è¦å¼€å‘è€…è‡ªè¡Œè§£å†³ã€‚</li>
</ol>
<p>è€Œæœ¬æ–‡ï¼ŒæœŸæœ›èƒ½å¯¹è¿™è‹¥å¹²é—®é¢˜ï¼Œé€ä¸ªæä¾›è§£å†³æ–¹æ¡ˆã€‚</p>
<h1 id="2-æ™ºèƒ½è·¯ç”±è·³è½¬-â€”-Navigator-æ¨¡å—"><a href="#2-æ™ºèƒ½è·¯ç”±è·³è½¬-â€”-Navigator-æ¨¡å—" class="headerlink" title="2. æ™ºèƒ½è·¯ç”±è·³è½¬ â€” Navigator æ¨¡å—"></a>2. æ™ºèƒ½è·¯ç”±è·³è½¬ â€” Navigator æ¨¡å—</h1><p>åœ¨è¿™é‡Œæˆ‘ä»¬ä¸€èµ·è§£å†³ï¼š</p>
<ol>
<li>åŸç”Ÿ API é Promsie</li>
<li>é¡µé¢æ ˆçªç ´åå±‚æ—¶ç‰¹æ®Šå¤„ç†</li>
<li>ç‰¹æ®Šé¡µé¢ Tab çš„è·³è½¬å¤„ç†</li>
</ol>
<p>æˆ‘ä»¬çš„æ€è·¯æ˜¯ï¼Œå¸Œæœ›èƒ½è®¾è®¡ä¸€ç§é€»è¾‘ï¼Œæ ¹æ®åœºæ™¯æ¥è‡ªåŠ¨åˆ¤æ–­ä½¿ç”¨å“ªä¸ªå¾®ä¿¡è·¯ç”± APIï¼Œç„¶åå¯¹å¤–åªæä¾›ä¸€ä¸ªå‡½æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gotoPage(<span class="string">'/pages/goods/index'</span>)</div></pre></td></tr></table></figure>
<p>å…·ä½“é€»è¾‘å¦‚ä¸‹ï¼š</p>
<ol>
<li>å½“è·³è½¬çš„è·¯ç”±ä¸ºå°ç¨‹åº tab é¡µé¢æ—¶ï¼Œåˆ™ä½¿ç”¨ <code>wx.switchTab</code>ã€‚</li>
<li>å½“é¡µé¢æ ˆè¾¾åˆ° 10 å±‚ä¹‹åï¼Œå¦‚æœè¦è·³è½¬çš„é¡µé¢åœ¨é¡µé¢æ ˆä¸­ï¼Œä½¿ç”¨ <code>wx.navigateBack({ delta: X })</code> å‡ºæ ˆåˆ°ç›®æ ‡é¡µé¢ã€‚</li>
<li>å½“é¡µé¢æ ˆè¾¾åˆ° 10 å±‚ä¹‹åï¼Œç›®æ ‡é¡µé¢ä¸å­˜åœ¨é¡µé¢æ ˆä¸­ï¼Œä½¿ç”¨ <code>wx.redirectTo</code> æ›¿æ¢æ ˆé¡¶é¡µé¢ã€‚</li>
<li>å…¶ä»–æƒ…å†µä½¿ç”¨ <code>wx.navigateTo</code></li>
</ol>
<p>é¡ºå¸¦çš„ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå‡½æ•°ä»¥ Promise å½¢å¼å®ç°ï¼Œä»¥åŠæ”¯æŒå‚æ•°ä½œä¸º <code>object</code>ä¼ å…¥ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gotoPage(<span class="string">'/pages/goods/index'</span>, &#123; <span class="attr">name</span>: <span class="string">'jc'</span> &#125;).then(...).catch(...);</div></pre></td></tr></table></figure>
<p>å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ï¼Œåªè¦ä½¿ç”¨<code>gotoPage</code>å°±èƒ½æ»¡è¶³ã€‚</p>
<p>é‚£è‚¯å®šä¹Ÿä¼šæœ‰ç‰¹å®šçš„æƒ…å†µï¼Œéœ€è¦æ˜¾å¼çš„æŒ‡å®šä½¿ç”¨ <code>navigateTo/switchTab/redirectTo/navigateBack</code>çš„å“ªä¸€ä¸ªã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬ä¹ŸæŒ‰ç…§ç±»ä¼¼çš„å®ç°ï¼Œæ»¡è¶³ç›¸åŒæ¨¡å¼çš„ API</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">navigateTo(<span class="string">'/pages/goods/index'</span>, &#123; <span class="attr">name</span>: <span class="string">'jc'</span> &#125;).then(...).catch(...);</div><div class="line">switchTab(<span class="string">'/pages/goods/index'</span>, &#123; <span class="attr">name</span>: <span class="string">'jc'</span> &#125;).then(...).catch(...);</div><div class="line">redirectTo(<span class="string">'/pages/goods/index'</span>, &#123; <span class="attr">name</span>: <span class="string">'jc'</span> &#125;).then(...).catch(...);</div><div class="line">navigateBack(<span class="string">'/pages/goods/index'</span>, &#123; <span class="attr">name</span>: <span class="string">'jc'</span> &#125;).then(...).catch(...);</div></pre></td></tr></table></figure>
<p>è¿™äº›å‡½æ•°éƒ½å¯ä»¥å†…èšåˆ°åŒä¸€ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬ç§°å…¶ä¸ºï¼š<strong>Navigator</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> navigator = <span class="keyword">new</span> Navigator();</div><div class="line">navigator.gotoPage(...);</div><div class="line">navigator.navigateTo(...);</div><div class="line">navigator.switchTab(...);</div><div class="line">navigator.redirectTo(...);</div><div class="line">navigator.navigateBack(...);</div></pre></td></tr></table></figure>
<p>æ¨¡å—è®¾è®¡ï¼š</p>
<p><img src="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210321202552.png" alt="navigator-class"></p>
<h1 id="3-è™šæ‹Ÿè·¯ç”±ç­–ç•¥-â€”-Router-æ¨¡å—"><a href="#3-è™šæ‹Ÿè·¯ç”±ç­–ç•¥-â€”-Router-æ¨¡å—" class="headerlink" title="3. è™šæ‹Ÿè·¯ç”±ç­–ç•¥ â€” Router æ¨¡å—"></a>3. è™šæ‹Ÿè·¯ç”±ç­–ç•¥ â€” Router æ¨¡å—</h1><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è§£å†³ï¼š</p>
<ol>
<li>å¯¹å¤–æš´éœ²äº†çœŸå®è·¯ç”±ï¼Œå¯¼è‡´å†å²åŒ…è¢±æ²‰é‡çš„é—®é¢˜ã€‚</li>
</ol>
<p>åœ¨è®¸å¤šåº”ç”¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æŠŠæŸç§æ¨¡å¼åŒ¹é…åˆ°çš„æ‰€æœ‰è·¯ç”±ï¼Œå…¨éƒ½æ˜ å°„åˆ°åŒä¸ªé¡µé¢ä¸­å»ã€‚<br>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª Goods é¡µé¢ï¼Œå¯¹äºæ‰€æœ‰ ID å„ä¸ç›¸åŒçš„å•†å“ï¼Œéƒ½è¦ä½¿ç”¨è¿™ä¸ªé¡µé¢æ¥æ‰¿è½½ã€‚  </p>
<p><img src="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210321202632.png" alt=""></p>
<p>é‚£ä¹ˆåœ¨ä»£ç å±‚é¢ä¸Šï¼ŒæœŸæœ›èƒ½å®ç°è¿™æ ·çš„è°ƒç”¨æ–¹å¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åˆ›å»ºè·¯ç”±å®ä¾‹</span></div><div class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</div><div class="line"></div><div class="line"><span class="comment">// æ³¨å†Œè·¯ç”±</span></div><div class="line">router.register(&#123;</div><div class="line">  <span class="attr">path</span>: <span class="string">'/goods/:id'</span>, <span class="comment">// è™šæ‹Ÿè·¯ç”±</span></div><div class="line">  route: <span class="string">'/pages/goods/index'</span>, <span class="comment">// çœŸå®è·¯ç”±</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// è·³è½¬åˆ° /pages/goods/indexï¼Œå‚æ•°: onLoad(options) çš„ options = &#123; id: '123' &#125;</span></div><div class="line">router.gotoPage(<span class="string">'/goods/123'</span>);</div><div class="line"></div><div class="line"><span class="comment">// è·³è½¬åˆ° /pages/goods/indexï¼Œå‚æ•°: onLoad(options) çš„ options = &#123; id: '456' &#125;</span></div><div class="line">router.gotoPage(<span class="string">'/goods/456'</span>);</div></pre></td></tr></table></figure>
<p><strong>Class Router</strong> çš„æ ¸å¿ƒé€»è¾‘æ˜¯å®Œæˆï¼š</p>
<ol>
<li>è·¯ç”±çš„æ³¨å†Œï¼Œå®Œæˆã€Œè™šæ‹Ÿè·¯å¾„ã€å’Œã€ŒçœŸå®è·¯å¾„ã€å…³ç³»çš„å­˜å‚¨ã€‚</li>
<li>æ»¡è¶³ã€Œè™šæ‹Ÿè·¯å¾„ã€åˆ°ã€ŒçœŸå®è·¯å¾„ã€çš„è½¬æ¢ï¼Œå¹¶ä¸”è¯†åˆ«ã€ŒåŠ¨æ€è·¯å¾„å‚æ•°ã€ï¼ˆdynamic segmentï¼‰ã€‚</li>
<li>è·¯ç”±è·³è½¬ã€‚</li>
</ol>
<p>å¯¹äºã€Œè·¯ç”±çš„æ³¨å†Œã€ï¼Œæˆ‘ä»¬åœ¨å…¶å†…éƒ¨å­˜å‚¨ä¸€ä¸ª map å°±èƒ½å®Œæˆã€‚</p>
<p>è€Œå¯¹äºã€Œè·¯å¾„çš„è½¬æ¢ã€ï¼Œ <code>vue-router</code> æœ‰ç±»ä¼¼çš„å®ç°ï¼Œé€šè¿‡å…¶æºç å‘ç°ï¼Œå†…éƒ¨æ˜¯ä½¿ç”¨  <a href="https://github.com/pillarjs/path-to-regexp" target="_blank" rel="external">path-to-regexp</a> ä½œä¸ºè·¯å¾„åŒ¹é…å¼•æ“ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¿æ¥ç”¨ä¹‹ã€‚</p>
<p>ç„¶åå¯¹äºã€Œè·¯ç”±çš„è·³è½¬ã€ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¤ç”¨ä¸Šé¢æåˆ°çš„ <strong>Navigator</strong> æ¨¡å—ï¼Œé€šè¿‡è¾“å…¥çœŸå®è·¯å¾„ï¼Œæ¥å®Œæˆè·¯ç”±çš„è·³è½¬ã€‚</p>
<p>æ¨¡å—è®¾è®¡ï¼š</p>
<p><img src="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210321202636.png" alt="route-class"></p>
<p>å…¶ä¸­ï¼š</p>
<ol>
<li>RouteMatcherï¼šæä¾›åŠ¨æ€è·¯ç”±å‚æ•°åŒ¹é…åŠŸèƒ½ï¼Œå†…éƒ¨ä½¿ç”¨  <a href="https://github.com/pillarjs/path-to-regexp" target="_blank" rel="external">path-to-regexp</a> ä½œä¸ºè·¯å¾„åŒ¹é…å¼•æ“ã€‚</li>
<li>Route: ä¸ºæ¯ä¸ªè·¯å¾„åˆ›å»ºè·¯ç”±å™¨ï¼Œå­˜å‚¨æ¯ä¸ªè·¯ç”±çš„è™šæ‹Ÿè·¯å¾„å’ŒçœŸå®è·¯ç”±çš„å…³ç³»ã€‚</li>
<li>Routerï¼šæ•´åˆå†…éƒ¨å„æ¨¡å—ï¼Œå¯¹å¤–æä¾›ç»Ÿä¸€ä¸”ä¼˜é›…çš„è°ƒç”¨æ–¹å¼ã€‚</li>
</ol>
<h1 id="4-è½åœ°ä¸­è½¬ç­–ç•¥-â€”-LandTransfer-æ¨¡å—"><a href="#4-è½åœ°ä¸­è½¬ç­–ç•¥-â€”-LandTransfer-æ¨¡å—" class="headerlink" title="4. è½åœ°ä¸­è½¬ç­–ç•¥ â€” LandTransfer æ¨¡å—"></a>4. è½åœ°ä¸­è½¬ç­–ç•¥ â€” LandTransfer æ¨¡å—</h1><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è§£å†³ï¼š</p>
<ol>
<li>å°ç¨‹åºæ‰«ç ã€å…¬ä¼—å·é“¾æ¥ç­‰åœºæ™¯ä¸‹çš„è½åœ°é¡µç»Ÿä¸€ã€‚</li>
<li>å°ç¨‹åºç ï¼Œå¯¹äºæ— é™é‡API <a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/qr-code/wxacode.getUnlimited.html" target="_blank" rel="external">wxacode.getUnlimited</a> ï¼Œçªç ´å‚æ•°32ä½é•¿åº¦é™åˆ¶ã€‚</li>
</ol>
<h2 id="4-1-å¯¹äºè¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šç»Ÿä¸€çš„è½åœ°é¡µ"><a href="#4-1-å¯¹äºè¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šç»Ÿä¸€çš„è½åœ°é¡µ" class="headerlink" title="4.1. å¯¹äºè¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šç»Ÿä¸€çš„è½åœ°é¡µ"></a>4.1. å¯¹äºè¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šç»Ÿä¸€çš„è½åœ°é¡µ</h2><p>æˆ‘ä»¬æŠŠå¦‚ï¼šæ‰«å°ç¨‹åºç ã€å…¬ä¼—å·èœå•ã€å…¬ä¼—å·æ–‡ç« ç­‰æ–¹å¼æ‰“å¼€å°ç¨‹åºæŸä¸ªé¡µé¢çš„è·¯å¾„ç§°ä¸ºã€Œå¤–éƒ¨è·¯ç”±ã€ã€‚</p>
<p>æ ¹æ®å°ç¨‹åºçš„è®¾è®¡ï¼Œæš´éœ²ç»™å¤–éƒ¨çš„è¿æ¥æ˜¯çœŸå®çš„é¡µé¢è·¯å¾„ï¼Œå¦‚ï¼š<code>/pages/home/index</code>ï¼Œè¯¥è®¾è®¡åœ¨å®è·µä¸­å­˜åœ¨çš„å¼Šç«¯ï¼š<strong>å„ä¸ªè½åœ°é¡µåˆ†æ•£ï¼ŒåæœŸä¿®æ”¹çœŸå®æ–‡ä»¶è·¯å¾„éš¾åº¦å¤§ã€‚</strong></p>
<p>åœ¨ <strong>ã€Œä¸­é•¿ç”Ÿå‘½å‘¨æœŸã€</strong> äº§å“ä¸­ï¼Œéšç€äº§å“çš„è¿­ä»£ï¼Œæˆ‘ä»¬éš¾å…ä¼šé‡åˆ°é¡¹ç›®çš„é‡æ„ã€‚å¦‚æœåˆ†å‘å‡ºå»çš„éƒ½æ˜¯æ²¡ç»è¿‡å¤„ç†çš„çœŸå®è·¯å¾„çš„è¯ï¼Œæˆ‘ä»¬é‡æ„æ—¶å°±ä¼šæŸæ‰‹æŸè„šï¼Œè¦åšå¾ˆå¤šçš„å…¼å®¹æ“ä½œã€‚å› ä¸ºä½ ä¸çŸ¥é“ï¼Œåˆ†å‘å‡ºå»çš„å°ç¨‹åºäºŒç»´ç ï¼Œ æœ‰å¤šå°‘è¢«æ‰“å°åˆ°å®ä½“ç‰©æ–™ä¸­ã€‚</p>
<p>é‚£ä¹ˆï¼Œ<strong>ã€Œè™šæ‹Ÿè·¯ç”±ã€+ã€Œè½åœ°ä¸­è½¬ã€</strong> çš„ç­–ç•¥å°±æ˜¾å¾—åŸºæœ¬ä¸”é‡è¦äº†ã€‚</p>
<p>ã€Œè™šæ‹Ÿè·¯ç”±ã€çš„åŠŸèƒ½ï¼Œ<strong>Router </strong>æ¨¡å—ç»™æˆ‘ä»¬æä¾›äº†æ”¯æŒäº†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹å¤–æä¾›ä¸€ä¸ªç»Ÿä¸€çš„è½åœ°é¡µé¢ï¼Œè®©å®ƒæ¥å®Œæˆå¯¹å†…éƒ¨è·¯ç”±çš„ä¸­è½¬ã€‚</p>
<p>åŸºæœ¬é€»è¾‘ï¼š</p>
<ol>
<li>åˆ†å‘å‡ºå»çš„çœŸå®è·¯ç”±ï¼ŒæŒ‡å‘åˆ°å”¯ä¸€çš„è½åœ°é¡µé¢ï¼Œå¦‚ï¼š<code>$LAND_PAGE: /pages/land-page/index</code></li>
<li>ç”±è¿™ä¸ªè½åœ°é¡µé¢ï¼Œè¿›è¡Œå†…éƒ¨è·¯ç”±çš„é‡å®šå‘è½¬å‘ï¼Œé€šè¿‡æ¥æ”¶ å‚æ•°ï¼Œå¦‚ï¼š<code>path=/user&amp;name=jc&amp;age=18</code></li>
</ol>
<p><img src="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210309185153.png" alt="æ™®é€šæ¨¡å¼"></p>
<p>åœ¨ä»£ç å±‚é¢ä¸Šï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å®ç°è¿™æ ·çš„ä½¿ç”¨ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /pages/land-page/index.ts</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> landTransfer = <span class="keyword">new</span> LandTransfer(landTransferOptions);</div><div class="line"></div><div class="line">Page(&#123;</div><div class="line">  onLoad(options) &#123;</div><div class="line">      landTransfer</div><div class="line">        .run(options)</div><div class="line">        .then(() =&gt; &#123;...&#125;)</div><div class="line">        .catch(() =&gt; &#123;...&#125;);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>ç„¶åé’ˆå¯¹ TSï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨è£…é¥°å™¨ç‰ˆæœ¬ï¼Œæ›´åŠ ç®€ä¾¿ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; landTransferDecorator &#125; from <span class="string">'wxapp-router'</span>;</div><div class="line"></div><div class="line">Page(&#123;</div><div class="line">  @landTransferDecorator(landTransferOptions)</div><div class="line">  onLoad(options) &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;,</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="4-2-å¯¹äºç¬¬äºŒä¸ªè¦è§£å†³çš„é—®é¢˜ï¼šçŸ­é“¾å‚æ•°"><a href="#4-2-å¯¹äºç¬¬äºŒä¸ªè¦è§£å†³çš„é—®é¢˜ï¼šçŸ­é“¾å‚æ•°" class="headerlink" title="4.2. å¯¹äºç¬¬äºŒä¸ªè¦è§£å†³çš„é—®é¢˜ï¼šçŸ­é“¾å‚æ•°"></a>4.2. å¯¹äºç¬¬äºŒä¸ªè¦è§£å†³çš„é—®é¢˜ï¼šçŸ­é“¾å‚æ•°</h2><p>å¾®ä¿¡å°ç¨‹åºä¸»è¦æä¾›äº†ä¸¤ä¸ªæ¥å£å»ç”Ÿæˆå°ç¨‹åºç ï¼š</p>
<ol>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/qr-code/wxacode.get.html" target="_blank" rel="external">wxacode.get</a>: è·å–å°ç¨‹åºç ï¼Œé€‚ç”¨äºéœ€è¦çš„ç æ•°é‡è¾ƒå°‘çš„ä¸šåŠ¡åœºæ™¯ã€‚<strong>é€šè¿‡è¯¥æ¥å£ç”Ÿæˆçš„å°ç¨‹åºç ï¼Œæ°¸ä¹…æœ‰æ•ˆï¼Œæ•°é‡é™åˆ¶ä¸º 100,000</strong> ä¸ª</li>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/qr-code/wxacode.getUnlimited.html" target="_blank" rel="external">wxacode.getUnlimited</a>: è·å–å°ç¨‹åºç ï¼Œé€‚ç”¨äºéœ€è¦çš„ç æ•°é‡æå¤šçš„ä¸šåŠ¡åœºæ™¯ã€‚<strong>é€šè¿‡è¯¥æ¥å£ç”Ÿæˆçš„å°ç¨‹åºç ï¼Œæ°¸ä¹…æœ‰æ•ˆï¼Œæ•°é‡æš‚æ— é™åˆ¶ã€‚</strong></li>
</ol>
<p>ç¬¬ä¸€ç§æ–¹å¼ï¼Œ<code>wxacode.get</code> æ•°é‡é™åˆ¶ä¸º 10w ä¸ªï¼Œè™½ç„¶é‡å¾ˆå¤§äº†ï¼Œç»å¤§å¤šæ•°çš„å°ç¨‹åºå¯èƒ½ç”¨ä¸åˆ°è¿™ä¸ªé‡ã€‚</p>
<p>ä½†å¦‚æœæˆ‘ä»¬è¿è¥çš„æ˜¯ä¸€ä¸ªä¸­å¤§å‹ç”µå•†å°ç¨‹åºçš„è¯ï¼Œå‡å¦‚ï¼š1w ç§å•†å“ x 10 ç§å•†å“è§„æ ¼ï¼Œé‚£å°±ä¼šè¶…è¿‡è¿™ä¸ªæ•°é‡ã€‚åˆ°æ—¶å€™å†è¿›è¡Œæ”¹é€ ï¼Œå°±å›°éš¾äº†ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœæŠ±ç€æ˜¯è¿è¥ä¸€ä¸ª <strong>ã€Œä¸­é•¿ç”Ÿå‘½å‘¨æœŸã€</strong> çš„äº§å“çš„è¯ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼š<code>wxacode.getUnlimited</code></p>
<p>ä¸å°½äººæ„çš„æ˜¯ï¼Œè™½ç„¶å®ƒæ²¡æœ‰æ•°é‡é™åˆ¶ï¼Œä½†æ˜¯å¯¹å‚æ•°ä¼šæœ‰ 32 ä¸ªå­—ç¬¦çš„é™åˆ¶ï¼Œæ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼ˆä¸€ä¸ª uuid å°± 32 å­—ç¬¦äº†ï¼‰ã€‚</p>
<p>å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ã€ŒçŸ­é“¾å‚æ•°ã€çš„å½¢å¼è§£å†³ï¼Œç”±äº<a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/qr-code/wxacode.getUnlimited.html" target="_blank" rel="external">wxacode.getUnlimited</a> ä¼šé€šè¿‡ <code>scene</code>å­—æ®µä½œä¸º query å‚æ•°ä¼ é€’ç»™å°ç¨‹åºçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>scene</code>å‚æ•°æ¥å®ç°çŸ­é“¾æœåŠ¡ï¼Œè¿™éœ€è¦åç«¯é…åˆã€‚</p>
<p>å‰åç«¯äº¤äº’å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210312182826.png" alt="SceneçŸ­é“¾æ¨¡å¼"></p>
<ol>
<li>å½“å°ç¨‹åºéœ€è¦ç”Ÿæˆå°ç¨‹åºç çš„æ—¶å€™ï¼Œè¯·æ±‚åç«¯æä¾›çš„æ¥å£ï¼Œä¾‹å¦‚ï¼š<code>/api/encodeShortParams</code></li>
<li>åç«¯æŠŠå†…å®¹è½¬æ¢ä¸º 32 å­—ç¬¦å†…çš„å­—ç¬¦ä¸²ï¼Œå­˜å‚¨åˆ°æ•°æ®åº“ä¸­ã€‚</li>
<li>åç«¯é€šè¿‡ <a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/qr-code/wxacode.getUnlimited.html" target="_blank" rel="external">wxacode.getUnlimited</a> æ¥å£ï¼Œä»¥çŸ­é“¾å­—ç¬¦ä¸²ä½œä¸º <code>scene</code>çš„å€¼ï¼Œä»¥å•†å®šå¥½çš„ç»Ÿä¸€è½åœ°é¡µ <code>$LAND_PAGE</code>ä½œä¸º <code>page</code>å€¼ï¼Œç”Ÿæˆå°ç¨‹åºç ã€‚</li>
<li>å½“é€šè¿‡å°ç¨‹åºç è¿›å…¥å°ç¨‹åºï¼Œå°ç¨‹åºè·å–åˆ° <code>scene</code>å‚æ•°ï¼Œè¯·æ±‚åç«¯æä¾›çš„æ¥å£ï¼Œä¾‹å¦‚ï¼š<code>/api/decodeShrotParams</code></li>
<li>å°ç¨‹åºç†è§£å†…å®¹ï¼Œè·³è½¬åˆ°ç›®æ ‡é¡µé¢ä¸­å»ã€‚</li>
</ol>
<p>è€Œå‰ç«¯å¯¹äºç»Ÿä¸€è½åœ°é¡µçš„é€»è¾‘å¤„ç†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç¬¬ä¸€ä¸ªé—®é¢˜çš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ª<strong>è½¬æ¢çŸ­é“¾å‚æ•°å†…å®¹</strong>çš„é€»è¾‘å°±è¡Œäº†ï¼š</p>
<p><img src="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210309185154.png" alt="çŸ­é“¾æ¨¡å¼"></p>
<p>ä»£ç å±‚é¢ä¸Šï¼Œæˆ‘ä»¬æˆ‘ä»¬åªéœ€è¦å¤šå®šä¹‰è½¬æ¢çŸ­é“¾å‚æ•°çš„æ–¹å¼ï¼š<code>convertScenePrams</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// in /pages/land-page/index.js</span></div><div class="line"><span class="keyword">import</span> &#123; landTransferDecorator &#125; from <span class="string">'wxapp-router'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> landTransferOptions = &#123;</div><div class="line">  <span class="comment">// æ­¤å¤„æ¥æ”¶ onLoad(options) ä¸­çš„ options.scene</span></div><div class="line">  convertSceneParams: (sceneParams) =&gt; &#123;</div><div class="line">    <span class="keyword">return</span> API.convertScene(&#123; sceneParams &#125;).then((content) =&gt; &#123;</div><div class="line">      <span class="comment">// å‡å¦‚åç«¯å­˜çš„æ˜¯ JSON å­—ç¬¦ä¸²ï¼Œå‰ç«¯decode</span></div><div class="line">      <span class="comment">// è¦æ±‚ content = &#123; path: '/home', a: 1, b:2 &#125;</span></div><div class="line">      <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(content);</div><div class="line">    &#125;);</div><div class="line">  &#125;,</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Page(&#123;</div><div class="line">  @landTransferDecorator(landTransferOptions)</div><div class="line">  onLoad(options) &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;,</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>è€Œå…¶ä¸­çš„ <code>API.convertScene</code> å°±å¯¹æ¥æœåŠ¡ç«¯æä¾› HTTP æ¥å£æœåŠ¡æ¥å®Œæˆã€‚</p>
<h2 id="4-3-LandTransfer-æ¨¡å—è®¾è®¡"><a href="#4-3-LandTransfer-æ¨¡å—è®¾è®¡" class="headerlink" title="4.3. LandTransfer æ¨¡å—è®¾è®¡"></a>4.3. LandTransfer æ¨¡å—è®¾è®¡</h2><p><img src="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210321202654.png" alt="land-transfer"></p>
<h1 id="5-æ›´å¥½çš„å¼€å‘ä½“éªŒ"><a href="#5-æ›´å¥½çš„å¼€å‘ä½“éªŒ" class="headerlink" title="5. æ›´å¥½çš„å¼€å‘ä½“éªŒ"></a>5. æ›´å¥½çš„å¼€å‘ä½“éªŒ</h1><h2 id="5-1-Typescript-Router"><a href="#5-1-Typescript-Router" class="headerlink" title="5.1. Typescript + Router"></a>5.1. Typescript + Router</h2><p>å¯¹äºå°ç¨‹åºå†…éƒ¨çš„è·¯ç”±è·³è½¬ï¼Œæˆ‘ä»¬é™¤äº†æŒ‡å®šä¸€ä¸ªå­—ç¬¦ä¸²çš„è·¯ç”±ï¼Œæˆ‘ä»¬æ˜¯å¦ä¹Ÿå¯ä»¥é€šè¿‡é“¾å¼è°ƒç”¨ï¼Œåƒè°ƒç”¨å‡½æ•°é‚£æ ·å»è·³è½¬é¡µé¢å‘¢ï¼Ÿç±»ä¼¼è¿™æ ·ï¼›</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">routes.pages.user.go(&#123; name: <span class="string">'jc'</span> &#125;);</div></pre></td></tr></table></figure>
<p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š</p>
<ol>
<li>æ›´è‡ªç„¶çš„è°ƒç”¨æ–¹å¼ã€‚</li>
<li>èƒ½ç»“åˆ TSï¼Œæ¥åšåˆ°ç±»å‹æç¤ºå’Œè”æƒ³ã€‚</li>
</ol>
<p>ç”±äºäº‹å…ˆ <code>wxapp-router</code> å¹¶ä¸çŸ¥é“å¼€å‘è€…éœ€è¦æ³¨å†Œçš„è·¯ç”±æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œæ‰€ä»¥è·¯ç”±çš„ TS å£°æ˜æ–‡ä»¶ï¼Œéœ€è¦å¼€å‘è€…æ¥å®šä¹‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ç»´æŠ¤ä¸€ä»½è·¯ç”±æ–‡ä»¶ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// config/routes.ts</span></div><div class="line"></div><div class="line"><span class="comment">// åˆ›å»ºè·¯ç”±å®ä¾‹</span></div><div class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</div><div class="line"></div><div class="line"><span class="keyword">const</span> routesConfig = [&#123;</div><div class="line">  path: <span class="string">'/user'</span>,</div><div class="line">  route: <span class="string">'/pages/user/index'</span>,</div><div class="line">&#125;, &#123;</div><div class="line">  path: <span class="string">'/goods'</span>,</div><div class="line">  route: <span class="string">'/pages/goods/index'</span>,</div><div class="line">&#125;]ï¼›</div><div class="line"></div><div class="line"><span class="keyword">type</span> RoutesType &#123;</div><div class="line">  paegs: &#123;</div><div class="line">    user: Route&lt;&#123;name: <span class="built_in">string</span>&#125;&gt;,</div><div class="line">    goods: Route,</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æ³¨å†Œè·¯ç”±</span></div><div class="line">router.batchRegister(routesConfig);</div><div class="line"></div><div class="line"><span class="comment">// è·å– routes</span></div><div class="line"><span class="keyword">const</span> routes: RoutesType = router.getRoutes();</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> routes;</div></pre></td></tr></table></figure>
<p>ç„¶ååœ¨åˆ«çš„åœ°æ–¹ä½¿ç”¨å®ƒï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> routes from <span class="string">'./routes.ts'</span>;</div><div class="line"></div><div class="line">routes.pages.user.go(&#123; name: <span class="string">'jc'</span> &#125;);</div></pre></td></tr></table></figure>
<h2 id="5-2-æ™ºèƒ½ç”Ÿæˆè·¯ç”±é…ç½®"><a href="#5-2-æ™ºèƒ½ç”Ÿæˆè·¯ç”±é…ç½®" class="headerlink" title="5.2. æ™ºèƒ½ç”Ÿæˆè·¯ç”±é…ç½®"></a>5.2. æ™ºèƒ½ç”Ÿæˆè·¯ç”±é…ç½®</h2><p>å¦‚æœè·¯ç”±å˜å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹æ¯ä¸ªè·¯ç”±æ‰‹åŠ¨å»ç¼–å†™ <code>RoutesType</code> çš„è¯ï¼Œå°±æœ‰ç‚¹éš¾å—äº†ã€‚</p>
<p>åœ¨å°ç¨‹åºä¸­ï¼Œæˆ‘ä»¬æŠŠæ­£å¼è·¯ç”±éƒ½é…ç½®åˆ° <code>app.json</code> ï¼Œé‚£ä¹ˆåœ¨éµå¾ªæ—¢å®šçš„é¡¹ç›®ç»“æ„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªåŠ¨æ„å»ºï¼Œå®Œæˆå¤§éƒ¨åˆ†å·¥ä½œï¼Œä¾‹å¦‚ï¼š</p>
<ol>
<li>æ™ºèƒ½æ³¨å†Œè·¯ç”±</li>
<li>æ™ºèƒ½è¯†åˆ«é¡µé¢å…¥å‚å£°æ˜</li>
</ol>
<h2 id="5-3-è‡ªå®šä¹‰ç»„ä»¶è·³è½¬"><a href="#5-3-è‡ªå®šä¹‰ç»„ä»¶è·³è½¬" class="headerlink" title="5.3. è‡ªå®šä¹‰ç»„ä»¶è·³è½¬"></a>5.3. è‡ªå®šä¹‰ç»„ä»¶è·³è½¬</h2><p>ä»¥ä¸Šéƒ½æ˜¯è„šæœ¬å±‚é¢çš„ä½¿ç”¨ï¼Œå°ç¨‹åºä¸­è¿˜æœ‰ <code>wxml</code>, æˆ‘ä»¬å¸Œæœ›èƒ½åœ¨æœ‰ä¸ªç»„ä»¶å¿«é€Ÿä½¿ç”¨ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">path</span>=<span class="string">"/pageA"</span> <span class="attr">query</span>=<span class="string">"&#123;&#123;pageAQuery&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">Router</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">path</span>=<span class="string">"/pageB"</span> <span class="attr">query</span>=<span class="string">"&#123;&#123;pageBQuery&#125;&#125;"</span> <span class="attr">type</span>=<span class="string">"redirectTo"</span>&gt;</span><span class="tag">&lt;/<span class="name">Router</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">path</span>=<span class="string">"/pageC/katy"</span>&gt;</span><span class="tag">&lt;/<span class="name">Router</span>&gt;</span></div></pre></td></tr></table></figure>
<p>é‚£ä¹ˆï¼Œå®ç°ä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶ï¼Œç„¶åæŠŠ <strong>Router</strong>æ¨¡å—åŒ…è£…ä¸€ä¸‹ï¼Œé—®é¢˜å°±ä¸å¤§äº†ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// components/router.wxml</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"wxapp-router"</span> <span class="attr">bind:tap</span>=<span class="string">"gotoPage"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">slot</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// components/router.ts</span></div><div class="line"></div><div class="line">Component(&#123;</div><div class="line">    properties: &#123;</div><div class="line">        path: <span class="built_in">String</span>,</div><div class="line">        <span class="keyword">type</span>: &#123;</div><div class="line">            <span class="keyword">type</span>: <span class="built_in">String</span>,</div><div class="line">            value: <span class="string">'gotoPage'</span></div><div class="line">        &#125;,</div><div class="line">        route: <span class="built_in">String</span>,</div><div class="line">        query: <span class="built_in">Object</span>,</div><div class="line">        delta: <span class="built_in">Number</span>,</div><div class="line">        setData: <span class="built_in">Object</span>,</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    methods: &#123;</div><div class="line">        gotoPage(event) &#123;</div><div class="line">            <span class="keyword">const</span> router = getApp().router;</div><div class="line">            <span class="keyword">const</span> &#123; path, route, <span class="keyword">type</span>, query&#125; = <span class="keyword">this</span>.data;</div><div class="line">            <span class="keyword">const</span> toPath = route || path;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> ([<span class="string">'gotoPage'</span>, <span class="string">'navigateTo'</span>, <span class="string">'switchTab'</span>, <span class="string">'redirectTo'</span>].includes(<span class="keyword">type</span>)) &#123;</div><div class="line">                (router as <span class="built_in">any</span>)[<span class="keyword">type</span>](toPath, query);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="string">'navigateBack'</span>) &#123;</div><div class="line">                <span class="keyword">const</span> &#123; delta, setData &#125; = <span class="keyword">this</span>.data;</div><div class="line">                router.navigateBack(&#123; delta &#125;, &#123; setData &#125;)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h1 id="6-æ•´ä½“æ¶æ„å›¾"><a href="#6-æ•´ä½“æ¶æ„å›¾" class="headerlink" title="6. æ•´ä½“æ¶æ„å›¾"></a>6. æ•´ä½“æ¶æ„å›¾</h1><p>æœ€åï¼Œæˆ‘ä»¬æ¥æ•´ä½“å›é¡¾ä¸€ä¸‹å„æ¨¡å—çš„è®¾è®¡</p>
<p><img src="https://raw.githubusercontent.com/JerryC8080/figure-bed/master/img/20210321202700.png" alt="æ¶æ„è®¾è®¡"></p>
<ol>
<li>Navigatorï¼šå°è£…å¾®ä¿¡åŸç”Ÿè·¯ç”± APIï¼Œæä¾›æ™ºèƒ½è·³è½¬ç­–ç•¥ã€‚</li>
<li>LandTransferï¼šæä¾›è½åœ°é¡µä¸­è½¬ç­–ç•¥ã€‚</li>
<li>RouteMatcherï¼šæä¾›åŠ¨æ€è·¯ç”±å‚æ•°åŒ¹é…åŠŸèƒ½ã€‚</li>
<li>Route: ä¸ºæ¯ä¸ªè·¯å¾„åˆ›å»ºè·¯ç”±å™¨ã€‚</li>
<li>Routerï¼šæ•´åˆå†…éƒ¨å„æ¨¡å—ï¼Œå¯¹å¤–æä¾›ä¼˜é›…çš„è°ƒç”¨æ–¹å¼ã€‚</li>
<li>Loggerï¼šå†…éƒ¨æ—¥å¿—å™¨ã€‚</li>
<li>Path-to-regexp: å¼€æºç¤¾åŒºçš„è·¯ç”±åŒ¹é…å¼•æ“ã€‚</li>
</ol>
<h1 id="7-æœ€åçš„æœ€å"><a href="#7-æœ€åçš„æœ€å" class="headerlink" title="7. æœ€åçš„æœ€å"></a>7. æœ€åçš„æœ€å</h1><p>é‰´äºå†™è¿‡å¾ˆå¤šçš„å®æˆ˜ç±»çš„æ–‡ç« ï¼Œä¼šæœ‰ä¸å°‘åŒå­¦æƒ³è¦åˆ°æ•´ä½“çš„ç¤ºä¾‹ä»£ç ï¼Œè¿™æ¬¡æˆ‘å°±ç´¢æ€§å†™äº†ä¸€ä¸ªå·¥å…·ï¼ŒEnjoy it!</p>
<p><a href="https://github.com/JerryC8080/wxapp-router" target="_blank" rel="external">wxapp-router</a>ï¼š ğŸ›µ The router for Wechat Miniprogram</p>

    
  </div>

</article>


   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">æ”¯æŒä¸€ä¸‹</span>
      <div class="donation-body">
        <div class="tip text-center">æ‰«ä¸€æ‰«ï¼Œæ”¯æŒJerryC</div>
        <ul>
        
          <li class="item">
            
              <span>å¾®ä¿¡æ‰«ä¸€æ‰«</span>
            
            <img src="/images/qr-wechat.jpg" alt="">
          </li>
        
          <li class="item">
            
              <span>æ”¯ä»˜å®æ‰«ä¸€æ‰«</span>
            
            <img src="/images/qr-alipay.png" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2021/01/28/github-workflow/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="hide pull-right" href="/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">å…³é—­</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              åšå®¢
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              åˆ†ç±»
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              å‹é“¾
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              å…³äº
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/atom.xml"
              rel="noopener noreferrer"
              target="_blank"
              >
              RSS
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'bluesun-jerryc';
    
    var disqus_url = 'http://huang-jerryc.com/2021/03/21/wxapp-router-experience/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      // dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      dsq.src = '//c.disquscdn.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <!-- 
    <script id="dsq-count-scr" src="//bluesun-jerryc.disqus.com/count.js" async></script>
  -->
  <script id="dsq-count-scr" src="//c.disquscdn.com/count.js" async></script>



    

    
    

    

    
    

    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
